import asyncio
import os
import datetime
import pytz

from aiogram import Bot, Dispatcher
from aiogram.client.default import DefaultBotProperties
from aiogram.enums import ParseMode
from apscheduler.schedulers.asyncio import AsyncIOScheduler

TOKEN = os.environ.get('TELEGRAM_TOKEN')
TIMEZONE = pytz.timezone("Europe/Moscow")

# –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ: –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞—Ç–∞ - —Å–ø–∏—Å–æ–∫ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏ –∏ –≤—Ä–µ–º—è
SCHEDULE = [
    {"chat_id": -1002854381464, "days": ["tue","fri"], "time": "10:00"},  # 7-9
    {"chat_id": -4554489448, "days": ["tue","thu"], "time": "10:00"},  # 3-4
    {"chat_id": -1002318561176, "days": ["mon","thu"], "time": "10:00"},  # 10-13 –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ 19:30, –∞ —á–µ—Ç–≤–µ—Ä–≥ 19:10
    {"chat_id": -4546245490, "days": ["mon","wed"], "time": "10:00"},  # 5-6 –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ 18:20, –∞ —Å—Ä–µ–¥–∞ 18:00
    {"chat_id": -1002446646594, "days": ["wed","fri"], "time": "10:00"}  # 14-17 –ø—è—Ç–Ω–∏—Ü–∞ 17:30, –∞ —Å—Ä–µ–¥–∞ 19:10
]

# –°–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞—Ç–∞: —á–µ—Ç–Ω–∞—è –∏ –Ω–µ—á–µ—Ç–Ω–∞—è –Ω–µ–¥–µ–ª—è –ø–æ –¥–Ω—è–º
# –°–æ–æ–±—â–µ–Ω–∏—è –ø–æ —Å—Ö–µ–º–µ: MESSAGES[chat_id][weekday][odd/even]
MESSAGES = {
    -1002854381464: {
        "tue": {"even": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, —É–≤–∞–∂–∞–µ–º—ã–µ —Ä–æ–¥–∏—Ç–µ–ª–∏ üå∏\n–°–µ–≥–æ–¥–Ω—è —Å–æ—Å—Ç–æ–∏—Ç—Å—è –∑–∞–Ω—è—Ç–∏–µ –ø–æ —Ö–∏–ø-—Ö–æ–ø—É –≤ 19:10.\n\n–§–æ—Ä–º–∞ –æ–¥–µ–∂–¥—ã:\n\nüçÄ–®—Ç–∞–Ω—ã –∏–ª–∏ –ª–æ—Å–∏–Ω—ã.\nüçÄ–§—É—Ç–±–æ–ª–∫–∞.\nüçÄ–ö—Ä–æ—Å—Å–æ–≤–∫–∏.\n\n–ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫—Ç–æ –±—É–¥–µ—Ç —Å–µ–≥–æ–¥–Ω—è? üå∑",
            "odd":  "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, —É–≤–∞–∂–∞–µ–º—ã–µ —Ä–æ–¥–∏—Ç–µ–ª–∏ üå∏\n–°–µ–≥–æ–¥–Ω—è —Å–æ—Å—Ç–æ–∏—Ç—Å—è –∑–∞–Ω—è—Ç–∏–µ –ø–æ –∫–æ–Ω—Ç–µ–º–ø–æ—Ä–∞—Ä–∏ –≤ 19:10.\n\n–§–æ—Ä–º–∞ –æ–¥–µ–∂–¥—ã:\n\nüçÄ–®—Ç–∞–Ω—ã –∏–ª–∏ –ª–æ—Å–∏–Ω—ã.\nüçÄ–ö–æ—Ñ—Ç–∞ —Å –¥–ª–∏–Ω–Ω—ã–º —Ä—É–∫–∞–≤–æ–º.\nüçÄ–ù–æ—Å–æ—á–∫–∏.\n\n–ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫—Ç–æ –±—É–¥–µ—Ç —Å–µ–≥–æ–¥–Ω—è? üå∑"},
        # "fri": {
        #     "even": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, —É–≤–∞–∂–∞–µ–º—ã–µ —Ä–æ–¥–∏—Ç–µ–ª–∏ üå∏\n–°–µ–≥–æ–¥–Ω—è —Å–æ—Å—Ç–æ–∏—Ç—Å—è –∑–∞–Ω—è—Ç–∏–µ –ø–æ —Ö–∏–ø-—Ö–æ–ø—É –≤ 19:10.\n\n–§–æ—Ä–º–∞ –æ–¥–µ–∂–¥—ã:\n\nüçÄ–®—Ç–∞–Ω—ã –∏–ª–∏ –ª–æ—Å–∏–Ω—ã.\nüçÄ–§—É—Ç–±–æ–ª–∫–∞.\nüçÄ–ö—Ä–æ—Å—Å–æ–≤–∫–∏.\n\n–ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫—Ç–æ –±—É–¥–µ—Ç —Å–µ–≥–æ–¥–Ω—è? üå∑",
        #     "odd": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, —É–≤–∞–∂–∞–µ–º—ã–µ —Ä–æ–¥–∏—Ç–µ–ª–∏ üå∏\n–°–µ–≥–æ–¥–Ω—è —Å–æ—Å—Ç–æ–∏—Ç—Å—è –∑–∞–Ω—è—Ç–∏–µ –ø–æ –∫–æ–Ω—Ç–µ–º–ø–æ—Ä–∞—Ä–∏ –≤ 19:10.\n\nüçÄ–®—Ç–∞–Ω—ã –∏–ª–∏ –ª–æ—Å–∏–Ω—ã.\nüçÄ–ö–æ—Ñ—Ç–∞ —Å –¥–ª–∏–Ω–Ω—ã–º —Ä—É–∫–∞–≤–æ–º.\nüçÄ–ù–æ—Å–æ—á–∫–∏.\n\n–ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫—Ç–æ –±—É–¥–µ—Ç —Å–µ–≥–æ–¥–Ω—è? üå∑"}
    },
    -4554489448: {
        "tue": {"even": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, —É–≤–∞–∂–∞–µ–º—ã–µ —Ä–æ–¥–∏—Ç–µ–ª–∏ üå∏\n–°–µ–≥–æ–¥–Ω—è —Å–æ—Å—Ç–æ–∏—Ç—Å—è –∑–∞–Ω—è—Ç–∏–µ –≤ 18:00.\n\n–§–æ—Ä–º–∞ –æ–¥–µ–∂–¥—ã:\n\nüçÄ–®—Ç–∞–Ω—ã –∏–ª–∏ –ª–æ—Å–∏–Ω—ã.\nüçÄ–§—É—Ç–±–æ–ª–∫–∞.\nüçÄ–ë–∞–ª–µ—Ç–∫–∏.\n\n–ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫—Ç–æ –±—É–¥–µ—Ç —Å–µ–≥–æ–¥–Ω—è? üå∑",
            "odd":  "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, —É–≤–∞–∂–∞–µ–º—ã–µ —Ä–æ–¥–∏—Ç–µ–ª–∏ üå∏\n–°–µ–≥–æ–¥–Ω—è —Å–æ—Å—Ç–æ–∏—Ç—Å—è –∑–∞–Ω—è—Ç–∏–µ –≤ 18:00.\n\n–§–æ—Ä–º–∞ –æ–¥–µ–∂–¥—ã:\n\nüçÄ–®—Ç–∞–Ω—ã –∏–ª–∏ –ª–æ—Å–∏–Ω—ã.\nüçÄ–§—É—Ç–±–æ–ª–∫–∞.\nüçÄ–ë–∞–ª–µ—Ç–∫–∏.\n\n–ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫—Ç–æ –±—É–¥–µ—Ç —Å–µ–≥–æ–¥–Ω—è? üå∑"},
        "thu": {
            "even": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, —É–≤–∞–∂–∞–µ–º—ã–µ —Ä–æ–¥–∏—Ç–µ–ª–∏ üå∏\n–°–µ–≥–æ–¥–Ω—è —Å–æ—Å—Ç–æ–∏—Ç—Å—è –∑–∞–Ω—è—Ç–∏–µ –≤ 18:00.\n\n–§–æ—Ä–º–∞ –æ–¥–µ–∂–¥—ã:\n\nüçÄ–®—Ç–∞–Ω—ã –∏–ª–∏ –ª–æ—Å–∏–Ω—ã.\nüçÄ–§—É—Ç–±–æ–ª–∫–∞.\nüçÄ–ë–∞–ª–µ—Ç–∫–∏.\n\n–ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫—Ç–æ –±—É–¥–µ—Ç —Å–µ–≥–æ–¥–Ω—è? üå∑",
            "odd": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, —É–≤–∞–∂–∞–µ–º—ã–µ —Ä–æ–¥–∏—Ç–µ–ª–∏ üå∏\n–°–µ–≥–æ–¥–Ω—è —Å–æ—Å—Ç–æ–∏—Ç—Å—è –∑–∞–Ω—è—Ç–∏–µ –≤ 18:00.\n\n–§–æ—Ä–º–∞ –æ–¥–µ–∂–¥—ã:\n\nüçÄ–®—Ç–∞–Ω—ã –∏–ª–∏ –ª–æ—Å–∏–Ω—ã.\nüçÄ–§—É—Ç–±–æ–ª–∫–∞.\nüçÄ–ë–∞–ª–µ—Ç–∫–∏.\n\n–ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫—Ç–æ –±—É–¥–µ—Ç —Å–µ–≥–æ–¥–Ω—è? üå∑"}
    },
    -1002318561176: {
        "mon": {"even": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, —É–≤–∞–∂–∞–µ–º—ã–µ —Ä–æ–¥–∏—Ç–µ–ª–∏ ü§óüíú\n–°–µ–≥–æ–¥–Ω—è —Å–æ—Å—Ç–æ–∏—Ç—Å—è –∑–∞–Ω—è—Ç–∏–µ –ø–æ —Ö–∏–ø-—Ö–æ–ø—É –≤ 19:30.\n\n–§–æ—Ä–º–∞ –æ–¥–µ–∂–¥—ã:\n\nüçÄ–®—Ç–∞–Ω—ã –∏–ª–∏ –ª–æ—Å–∏–Ω—ã.\nüçÄ–§—É—Ç–±–æ–ª–∫–∞.\nüçÄ–ö—Ä–æ—Å—Å–æ–≤–∫–∏.\n\n–ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫—Ç–æ –±—É–¥–µ—Ç —Å–µ–≥–æ–¥–Ω—è? üå∑",
            "odd":  "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, —É–≤–∞–∂–∞–µ–º—ã–µ —Ä–æ–¥–∏—Ç–µ–ª–∏ ü§óüíú\n–°–µ–≥–æ–¥–Ω—è —Å–æ—Å—Ç–æ–∏—Ç—Å—è –∑–∞–Ω—è—Ç–∏–µ –ø–æ –∫–æ–Ω—Ç–µ–º–ø–æ—Ä–∞—Ä–∏ –≤ 19:30.\n\nüçÄ–®—Ç–∞–Ω—ã –∏–ª–∏ –ª–æ—Å–∏–Ω—ã.\nüçÄ–ö–æ—Ñ—Ç–∞ —Å –¥–ª–∏–Ω–Ω—ã–º —Ä—É–∫–∞–≤–æ–º.\nüçÄ–ù–æ—Å–æ—á–∫–∏.\n\n–ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫—Ç–æ –±—É–¥–µ—Ç —Å–µ–≥–æ–¥–Ω—è? üå∑"},
        "thu": {
            "even": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, —É–≤–∞–∂–∞–µ–º—ã–µ —Ä–æ–¥–∏—Ç–µ–ª–∏ ü§óüíú\n–°–µ–≥–æ–¥–Ω—è —Å–æ—Å—Ç–æ–∏—Ç—Å—è –∑–∞–Ω—è—Ç–∏–µ –ø–æ —Ö–∏–ø-—Ö–æ–ø—É –≤ 19:10.\n\n–§–æ—Ä–º–∞ –æ–¥–µ–∂–¥—ã:\n\nüçÄ–®—Ç–∞–Ω—ã –∏–ª–∏ –ª–æ—Å–∏–Ω—ã.\nüçÄ–§—É—Ç–±–æ–ª–∫–∞.\nüçÄ–ö—Ä–æ—Å—Å–æ–≤–∫–∏.\n\n–ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫—Ç–æ –±—É–¥–µ—Ç —Å–µ–≥–æ–¥–Ω—è? üå∑",
            "odd": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, —É–≤–∞–∂–∞–µ–º—ã–µ —Ä–æ–¥–∏—Ç–µ–ª–∏ ü§óüíú\n–°–µ–≥–æ–¥–Ω—è —Å–æ—Å—Ç–æ–∏—Ç—Å—è –∑–∞–Ω—è—Ç–∏–µ –ø–æ –∫–æ–Ω—Ç–µ–º–ø–æ—Ä–∞—Ä–∏ –≤ 19:10.\n\nüçÄ–®—Ç–∞–Ω—ã –∏–ª–∏ –ª–æ—Å–∏–Ω—ã.\nüçÄ–ö–æ—Ñ—Ç–∞ —Å –¥–ª–∏–Ω–Ω—ã–º —Ä—É–∫–∞–≤–æ–º.\nüçÄ–ù–æ—Å–æ—á–∫–∏.\n\n–ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫—Ç–æ –±—É–¥–µ—Ç —Å–µ–≥–æ–¥–Ω—è? üå∑"},
    },
    -4546245490: {
        "mon": {"even": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, —É–≤–∞–∂–∞–µ–º—ã–µ —Ä–æ–¥–∏—Ç–µ–ª–∏ ü§óüíú\n–°–µ–≥–æ–¥–Ω—è —Å–æ—Å—Ç–æ–∏—Ç—Å—è –∑–∞–Ω—è—Ç–∏–µ –ø–æ —Ö–∏–ø-—Ö–æ–ø—É –≤ 18:20.\n\n–§–æ—Ä–º–∞ –æ–¥–µ–∂–¥—ã:\n\nüçÄ–®—Ç–∞–Ω—ã –∏–ª–∏ –ª–æ—Å–∏–Ω—ã.\nüçÄ–§—É—Ç–±–æ–ª–∫–∞.\nüçÄ–ö—Ä–æ—Å—Å–æ–≤–∫–∏.\n\n–ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫—Ç–æ –±—É–¥–µ—Ç —Å–µ–≥–æ–¥–Ω—è? üå∑",
            "odd":  "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, —É–≤–∞–∂–∞–µ–º—ã–µ —Ä–æ–¥–∏—Ç–µ–ª–∏ ü§óüíú\n–°–µ–≥–æ–¥–Ω—è —Å–æ—Å—Ç–æ–∏—Ç—Å—è –∑–∞–Ω—è—Ç–∏–µ –ø–æ –∫–æ–Ω—Ç–µ–º–ø–æ—Ä–∞—Ä–∏ –≤ 18:20.\n\nüçÄ–®—Ç–∞–Ω—ã –∏–ª–∏ –ª–æ—Å–∏–Ω—ã.\nüçÄ–ö–æ—Ñ—Ç–∞ —Å –¥–ª–∏–Ω–Ω—ã–º —Ä—É–∫–∞–≤–æ–º.\nüçÄ–ù–æ—Å–æ—á–∫–∏.\n\n–ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫—Ç–æ –±—É–¥–µ—Ç —Å–µ–≥–æ–¥–Ω—è? üå∑"},
        # "wed": {
        #     "even": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, —É–≤–∞–∂–∞–µ–º—ã–µ —Ä–æ–¥–∏—Ç–µ–ª–∏ ü§óüíú\n–°–µ–≥–æ–¥–Ω—è —Å–æ—Å—Ç–æ–∏—Ç—Å—è –∑–∞–Ω—è—Ç–∏–µ –ø–æ —Ö–∏–ø-—Ö–æ–ø—É –≤ 18:00.\n\n–§–æ—Ä–º–∞ –æ–¥–µ–∂–¥—ã:\n\nüçÄ–®—Ç–∞–Ω—ã –∏–ª–∏ –ª–æ—Å–∏–Ω—ã.\nüçÄ–§—É—Ç–±–æ–ª–∫–∞.\nüçÄ–ö—Ä–æ—Å—Å–æ–≤–∫–∏.\n\n–ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫—Ç–æ –±—É–¥–µ—Ç —Å–µ–≥–æ–¥–Ω—è? üå∑",
        #     "odd": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, —É–≤–∞–∂–∞–µ–º—ã–µ —Ä–æ–¥–∏—Ç–µ–ª–∏ ü§óüíú\n–°–µ–≥–æ–¥–Ω—è —Å–æ—Å—Ç–æ–∏—Ç—Å—è –∑–∞–Ω—è—Ç–∏–µ –ø–æ –∫–æ–Ω—Ç–µ–º–ø–æ—Ä–∞—Ä–∏ –≤ 18:00.\n\nüçÄ–®—Ç–∞–Ω—ã –∏–ª–∏ –ª–æ—Å–∏–Ω—ã.\nüçÄ–ö–æ—Ñ—Ç–∞ —Å –¥–ª–∏–Ω–Ω—ã–º —Ä—É–∫–∞–≤–æ–º.\nüçÄ–ù–æ—Å–æ—á–∫–∏.\n\n–ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫—Ç–æ –±—É–¥–µ—Ç —Å–µ–≥–æ–¥–Ω—è? üå∑"},
    },
    -1002446646594: {
        # "wed": {"even": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, —É–≤–∞–∂–∞–µ–º—ã–µ —Ä–æ–¥–∏—Ç–µ–ª–∏ ü§óüíú\n–°–µ–≥–æ–¥–Ω—è —Å–æ—Å—Ç–æ–∏—Ç—Å—è –∑–∞–Ω—è—Ç–∏–µ –ø–æ —Ö–∏–ø-—Ö–æ–ø—É –≤ 19:10.\n\n–§–æ—Ä–º–∞ –æ–¥–µ–∂–¥—ã:\n\nüçÄ–®—Ç–∞–Ω—ã –∏–ª–∏ –ª–æ—Å–∏–Ω—ã.\nüçÄ–§—É—Ç–±–æ–ª–∫–∞.\nüçÄ–ö—Ä–æ—Å—Å–æ–≤–∫–∏.\n\n–ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫—Ç–æ –±—É–¥–µ—Ç —Å–µ–≥–æ–¥–Ω—è? üå∑",
        #     "odd":  "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, —É–≤–∞–∂–∞–µ–º—ã–µ —Ä–æ–¥–∏—Ç–µ–ª–∏ ü§óüíú\n–°–µ–≥–æ–¥–Ω—è —Å–æ—Å—Ç–æ–∏—Ç—Å—è –∑–∞–Ω—è—Ç–∏–µ –ø–æ –∫–æ–Ω—Ç–µ–º–ø–æ—Ä–∞—Ä–∏ –≤ 19:10.\n\nüçÄ–®—Ç–∞–Ω—ã –∏–ª–∏ –ª–æ—Å–∏–Ω—ã.\nüçÄ–ö–æ—Ñ—Ç–∞ —Å –¥–ª–∏–Ω–Ω—ã–º —Ä—É–∫–∞–≤–æ–º.\nüçÄ–ù–æ—Å–æ—á–∫–∏.\n\n–ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫—Ç–æ –±—É–¥–µ—Ç —Å–µ–≥–æ–¥–Ω—è? üå∑"},
        # "fri": {
        #     "even": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, —É–≤–∞–∂–∞–µ–º—ã–µ —Ä–æ–¥–∏—Ç–µ–ª–∏ ü§óüíú\n–°–µ–≥–æ–¥–Ω—è —Å–æ—Å—Ç–æ–∏—Ç—Å—è –∑–∞–Ω—è—Ç–∏–µ –ø–æ —Ö–∏–ø-—Ö–æ–ø—É –≤ 17:30.\n\n–§–æ—Ä–º–∞ –æ–¥–µ–∂–¥—ã:\n\nüçÄ–®—Ç–∞–Ω—ã –∏–ª–∏ –ª–æ—Å–∏–Ω—ã.\nüçÄ–§—É—Ç–±–æ–ª–∫–∞.\nüçÄ–ö—Ä–æ—Å—Å–æ–≤–∫–∏.\n\n–ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫—Ç–æ –±—É–¥–µ—Ç —Å–µ–≥–æ–¥–Ω—è? üå∑",
        #     "odd": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å, —É–≤–∞–∂–∞–µ–º—ã–µ —Ä–æ–¥–∏—Ç–µ–ª–∏ ü§óüíú\n–°–µ–≥–æ–¥–Ω—è —Å–æ—Å—Ç–æ–∏—Ç—Å—è –∑–∞–Ω—è—Ç–∏–µ –ø–æ –∫–æ–Ω—Ç–µ–º–ø–æ—Ä–∞—Ä–∏ –≤ 17:30.\n\nüçÄ–®—Ç–∞–Ω—ã –∏–ª–∏ –ª–æ—Å–∏–Ω—ã.\nüçÄ–ö–æ—Ñ—Ç–∞ —Å –¥–ª–∏–Ω–Ω—ã–º —Ä—É–∫–∞–≤–æ–º.\nüçÄ–ù–æ—Å–æ—á–∫–∏.\n\n–ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫—Ç–æ –±—É–¥–µ—Ç —Å–µ–≥–æ–¥–Ω—è? üå∑"},
    }
}

# HOLIDAYS = {
#     "2025-01-01", "2025-01-07", "2025-02-23", "2025-03-08",
#     "2025-05-01", "2025-05-09", "2025-06-12"
# }

bot = Bot(
    token=TOKEN,
    default=DefaultBotProperties(parse_mode=ParseMode.HTML)
)
# dp = Dispatcher()
scheduler = AsyncIOScheduler(timezone=TIMEZONE)

async def send_dynamic_message(chat_id: int, weekday: str):
    week_num = datetime.datetime.now(TIMEZONE).isocalendar()[1]
    # now = datetime.datetime.now(TIMEZONE)
    # today_str = now.strftime("%Y-%m-%d")
    # if today_str in HOLIDAYS:
    #     print(f"–°–µ–≥–æ–¥–Ω—è {today_str} ‚Äî –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π –¥–µ–Ω—å, —Ä–∞—Å—Å—ã–ª–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞ –¥–ª—è —á–∞—Ç–∞ {chat_id}.")
    #     return
    # week_num = now.isocalendar()[1]
    kind = "even" if week_num % 2 == 0 else "odd"
    msg = MESSAGES.get(chat_id, {}).get(weekday, {}).get(kind, "–°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –∑–∞–¥–∞–Ω–æ.")
    try:
        await bot.send_message(chat_id=chat_id, text=msg)
        print(f"–í {chat_id}, {weekday}: {msg}")
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –¥–ª—è {chat_id}, {weekday}: {e}")

def schedule_jobs():
    # jobs_set = set() # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –∑–∞–¥–∞–Ω–∏–π
    for sched in SCHEDULE:
        hour, minute = map(int, sched["time"].split(":"))
        for weekday in sched["days"]:
            # job_key = (sched["chat_id"], weekday, sched["time"])
            # if job_key not in jobs_set:
                scheduler.add_job(
                    send_dynamic_message,
                    "cron",
                    args=[sched["chat_id"], weekday],
                    day_of_week=weekday,
                    hour=hour,
                    minute=minute,
                )
                # jobs_set.add(job_key)

async def main():
    schedule_jobs()
    scheduler.start()
    # print("Aiogram-–±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–∞—Å—Å—ã–ª–∫–æ–π –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (–¥–Ω–∏ –Ω–µ–¥–µ–ª–∏, —á–µ—Ç–Ω–æ—Å—Ç—å –Ω–µ–¥–µ–ª–∏)!")
    # await dp.start_polling(bot)
    print("–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –¢–û–õ–¨–ö–û –∫–∞–∫ —Ä–∞—Å—Å—ã–ª—å—â–∏–∫ (–±–µ–∑ polling –∏ –∫–æ–º–∞–Ω–¥).")
    while True:
        await asyncio.sleep(3600)

if __name__ == "__main__":
    asyncio.run(main())